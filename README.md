# random_image_api
该api的主要功能是实现从一个包含多个 URL 的文本文件中随机选择一个 URL 并进行重定向。以下是该脚本各部分的详细解析：

### 文件与缓存设置
- **文件路径**: `file = 'images.txt'` 指定了包含 URL 列表的文本文件。
- **缓存文件路径**: `cache_file = 'cache.txt'` 指定了用于存储文件内容缓存的文件。
- **缓存时间**: `cache_time = 3600` 设置了缓存的有效时间（以秒为单位），默认为 1 小时。

### 错误处理函数
- **handle_error 函数**: 接受错误代码和错误信息作为参数，设置 HTTP 响应状态码并输出错误信息，之后终止脚本执行。

### 缓存生成函数
- **generate_cache 函数**:
  - 使用 `@file()` 函数读取文件内容，忽略空行和新行。
  - 如果读取失败或文件为空，调用 `handle_error` 函数返回 500 错误。
  - 否则，将文件内容编码为 JSON 格式并写入缓存文件。

### 缓存检查与使用
- 检查缓存文件是否存在且未过期（当前时间减去缓存文件修改时间小于缓存时间）。
- 如果缓存有效，直接从缓存文件中解码获取 URL 列表。
- 否则，调用 `generate_cache` 函数生成新的缓存文件并获取 URL 列表。

### 随机 URL 选择与重定向
- 使用 `array_rand` 函数从 URL 列表中随机选择一个 URL。
- 使用 `filter_var` 函数验证所选 URL 是否符合 URL 格式。
  - 如果不符合格式，调用 `handle_error` 函数返回 500 错误。
- 使用 `header` 函数设置 HTTP Location 头部，实现对随机选择 URL 的重定向。
- 最后，使用 `exit` 函数确保脚本在重定向后立即终止执行。
